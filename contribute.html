<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contribute</title>
  <link rel="stylesheet" href="../assets/css/extra.css">
</head>

<body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent="deep-purple"
  data-md-color-media data-new-gr-c-s-check-loaded="14.1260.0" data-gr-ext-installed>
  <div class="ds-contribute-container">
    <header class="md-header ds-md-header">
      <div class="ds-header-grid">
        <div class="ds-header-logo-title">
          <img src="../assets/images/Dolphins Insignia.png" alt="Dolphins Insignia"
            style="height:2.2em; vertical-align:middle; margin-right:10px; display:inline-block;" />
          <span class="ds-header-brand">Diesel-Electric Subs</span>
        </div>
      </div>
    </header>
    <form id="ds-form" class="ds-form" novalidate>
      <!-- Category + Question grid -->
      <div class="ds-meta-grid">
        <div class="ds-meta-label">Category: <span class="ds-meta-value" id="ds-category-text"></span></div>
        <div class="ds-meta-label">Question: <span class="ds-meta-value" id="ds-question-text"></span></div>
        <div class="ds-meta-hr-wrap">
          <hr class="ds-meta-hr">
        </div>
      </div>

      <input type="hidden" id="ds-category" name="category">
      <input type="hidden" id="ds-question" name="question" maxlength="252">

      <div class="ds-field">
        <textarea id="ds-comments" name="comments" cols="80" rows="15" placeholder="Contribute to this question â€” share facts, records, images, or context.
You can also report any factual or grammatical errors.
Your insights are greatly appreciated.
(Name and email are optional but help us follow up or credit you.)
" required></textarea>
        <div class="ds-label-with-button">
          <button type="submit" class="ds-send-btn">Send</button>
        </div>
      </div>

      <div class="ds-separator" aria-hidden="true"></div>

      <!-- Optional name/email box -->
      <fieldset class="ds-optional">
        <legend>Optional</legend>
        <div class="ds-field ds-inline">
          <label for="ds-name">Your name</label>
          <input id="ds-name" name="submitter_name">
        </div>
        <div class="ds-field ds-inline">
          <label for="ds-email">Email</label>
          <input id="ds-email" name="submitter_email" type="email">
        </div>
      </fieldset>

      <input type="text" name="website" id="ds-website" tabindex="-1" style="position:absolute;left:-9999px">
      <p id="ds-status" aria-live="polite"></p>
    </form>

    <p id="ds-source" style="font-size:.9rem; opacity:.8"></p>

    <script src="assets/js/submit.js"></script>
    <script>
      (() => {
        try {
          const raw = sessionStorage.getItem('ds_prefill');
          if (!raw) return;
          const p = JSON.parse(raw);

          if (p.category) {
            document.getElementById('ds-category-text').textContent = p.category;
            document.getElementById('ds-category').value = p.category;
          }
          if (p.question) {
            document.getElementById('ds-question-text').textContent = p.question;
            document.getElementById('ds-question').value = p.question;
          }

          if (p.src) {
            const el = document.getElementById('ds-source');
            // if (el) el.innerHTML = `From: <a href="${p.src}">${p.src}</a>`;
          }
        } catch { }
      })();
    </script>

    <script>
      (() => {
        const el = document.getElementById('ds-source');
        if (!el) return;
        try {
          const raw = sessionStorage.getItem('ds_prefill');
          if (!raw) return;
          const p = JSON.parse(raw);
          if (!p.src) return;

          const u = new URL(p.src, location.href);
          if (u.hostname === '127.0.0.1' || u.hostname === 'localhost') return; // hide in dev

          const label = p.question || decodeURIComponent(u.pathname);
          el.innerHTML = `From: <a href="${p.src}">${label}</a>`;
        } catch { }
      })();
    </script>

    <script>
      (() => {
        const nameEl = document.getElementById('ds-name');
        const emailEl = document.getElementById('ds-email');
        const FORM_KEY = 'ds_user_info';

        // --- Prefill name and email from localStorage ---
        try {
          const saved = JSON.parse(localStorage.getItem(FORM_KEY) || '{}');
          if (saved.name && nameEl) nameEl.value = saved.name;
          if (saved.email && emailEl) emailEl.value = saved.email;
        } catch (err) {
          console.warn('Could not parse stored user info', err);
        }

        // --- Save to localStorage whenever user leaves the field ---
        const saveUserInfo = () => {
          const info = {
            name: nameEl?.value?.trim() || '',
            email: emailEl?.value?.trim() || ''
          };
          localStorage.setItem(FORM_KEY, JSON.stringify(info));
        };

        nameEl?.addEventListener('change', saveUserInfo);
        emailEl?.addEventListener('change', saveUserInfo);
      })();
    </script>

    <script>
      (() => {
        const form = document.getElementById('ds-form');
        const comments = document.getElementById('ds-comments');
        const sendBtn = form.querySelector('.ds-send-btn');
        function updateSendBtn() {
          if (comments.value.trim().length > 0) {
            sendBtn.disabled = false;
            sendBtn.classList.remove('ds-send-btn-disabled');
          } else {
            sendBtn.disabled = true;
            sendBtn.classList.add('ds-send-btn-disabled');
          }
        }
        comments.addEventListener('input', updateSendBtn);
        updateSendBtn();
      })();
    </script>

    <script>
      (() => {
        const bucketBtn = document.getElementById('ds-copy-current');
        const comments = document.getElementById('ds-comments');
        bucketBtn?.addEventListener('click', () => {
          try {
            const raw = sessionStorage.getItem('ds_prefill');
            if (!raw) {
              alert('No FAQ answer found to copy.');
              return;
            }
            const p = JSON.parse(raw);
            // Try 'answer', then fallback to 'original_answer' if available
            const answerText = p.answer || p.original_answer || '';
            if (answerText) {
              comments.value = answerText;
              comments.dispatchEvent(new Event('input', { bubbles: true }));
            } else {
              alert('No FAQ answer found to copy.');
            }
          } catch (e) {
            alert('Error copying FAQ answer: ' + e);
          }
        });
      })();
    </script>

  </div>
</body>

</html>