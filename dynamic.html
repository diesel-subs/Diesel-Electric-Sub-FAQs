<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diesel-Electric Submarine FAQs</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .hero { background: linear-gradient(135deg, #1e3c72, #2a5298); color: white; padding: 60px 0; }
        .category-card { transition: transform 0.3s; cursor: pointer; }
        .category-card:hover { transform: translateY(-5px); }
        .faq-item { margin-bottom: 20px; }
        .faq-question { cursor: pointer; }
        .faq-answer { display: none; padding: 15px; background: #f8f9fa; border-left: 4px solid #007bff; }
        .search-box { max-width: 500px; margin: 20px auto; }
        .loading { text-align: center; padding: 40px; }
    </style>
</head>
<body>
    <div class="hero">
        <div class="container text-center">
            <h1 class="display-4">üî± Diesel-Electric Submarine FAQs</h1>
            <p class="lead">Your comprehensive guide to submarine knowledge</p>
            <div id="stats" class="alert alert-info mt-4">
                <strong>üìä Loading site statistics...</strong>
            </div>
            
            <!-- Search Box -->
            <div class="search-box">
                <div class="input-group">
                    <input type="text" id="searchInput" class="form-control" placeholder="Search FAQs...">
                    <button class="btn btn-light" onclick="searchFAQs()">üîç Search</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container my-5">
        <!-- Categories Section -->
        <div id="categoriesSection">
            <h2>üìö Browse by Category</h2>
            <div id="categories" class="row">
                <div class="loading">Loading categories...</div>
            </div>
        </div>

        <!-- FAQs Section (hidden by default) -->
        <div id="faqsSection" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 id="faqsTitle">FAQs</h2>
                <button class="btn btn-secondary" onclick="showCategories()">‚Üê Back to Categories</button>
            </div>
            <div id="faqs"></div>
        </div>

        <!-- Search Results Section -->
        <div id="searchSection" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 id="searchTitle">Search Results</h2>
                <button class="btn btn-secondary" onclick="showCategories()">‚Üê Back to Categories</button>
            </div>
            <div id="searchResults"></div>
        </div>
    </div>

    <script>
    // Global variables
    let currentCategories = [];
    let currentFAQs = [];

    // Load site statistics
    async function loadStats() {
        try {
            const response = await fetch('/api/faqs.php?action=stats');
            const stats = await response.json();
            
            document.getElementById('stats').innerHTML = `
                <strong>üìä Site Statistics:</strong> 
                ${stats.total_faqs} FAQs across ${stats.total_categories} categories
                <span class="badge bg-success ms-2">Database Online</span>
            `;
        } catch (error) {
            document.getElementById('stats').innerHTML = `
                <strong>‚ö†Ô∏è Loading from static content</strong>
                <span class="badge bg-warning ms-2">Database Connecting...</span>
            `;
        }
    }

    // Load categories
    async function loadCategories() {
        try {
            const response = await fetch('/api/faqs.php?action=categories');
            currentCategories = await response.json();
            
            const categoriesHTML = currentCategories.map(category => `
                <div class="col-md-4 mb-4">
                    <div class="card category-card h-100" onclick="loadCategoryFAQs(${category.id}, '${category.name}')">
                        <div class="card-body">
                            <h5 class="card-title">${getCategoryIcon(category.name)} ${category.name}</h5>
                            <p class="card-text">${getCategoryDescription(category.name)}</p>
                            <span class="badge bg-primary">Click to View FAQs</span>
                        </div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('categories').innerHTML = categoriesHTML;
        } catch (error) {
            document.getElementById('categories').innerHTML = `
                <div class="col-12">
                    <div class="alert alert-warning">
                        Unable to load categories. Please check back later.
                    </div>
                </div>
            `;
        }
    }

    // Get category icon
    function getCategoryIcon(name) {
        if (name.includes('Hull')) return 'üîß';
        if (name.includes('General')) return 'üá∫üá∏';
        if (name.includes('Life')) return 'üë•';
        if (name.includes('Operating')) return '‚öôÔ∏è';
        if (name.includes('Attacks')) return 'üí•';
        if (name.includes('Crews')) return 'üë®‚Äç‚úàÔ∏è';
        return 'üìã';
    }

    // Get category description
    function getCategoryDescription(name) {
        const descriptions = {
            'Hull and Compartments': 'Learn about submarine construction, hull design, and compartment layouts.',
            'US WW2 Subs in General': 'General information about American submarines during World War II.',
            'Life Aboard WW2 US Subs': 'Daily life, living conditions, and crew experiences aboard submarines.',
            'Operating US Subs in WW2': 'Operational procedures, tactics, and submarine warfare techniques.',
            'Attacks and Battles, Small and Large': 'Combat operations, battles, and military engagements.',
            'Who Were the Crews Aboard WW2 US Subs': 'Information about submarine crews, their roles, and backgrounds.'
        };
        return descriptions[name] || 'Detailed information about submarine operations and technology.';
    }

    // Load FAQs for a specific category
    async function loadCategoryFAQs(categoryId, categoryName) {
        try {
            const response = await fetch(`/api/faqs.php?action=faqs&category_id=${categoryId}`);
            currentFAQs = await response.json();
            
            document.getElementById('faqsTitle').textContent = `${getCategoryIcon(categoryName)} ${categoryName}`;
            
            const faqsHTML = currentFAQs.map((faq, index) => `
                <div class="faq-item">
                    <div class="card">
                        <div class="card-header faq-question" onclick="toggleFAQ(${index})">
                            <h6 class="mb-0">‚ùì ${faq.question}</h6>
                        </div>
                        <div id="faq-${index}" class="faq-answer">
                            <div class="card-body">
                                ${faq.answer.replace(/\n/g, '<br>')}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('faqs').innerHTML = faqsHTML;
            showSection('faqsSection');
        } catch (error) {
            alert('Error loading FAQs. Please try again.');
        }
    }

    // Toggle FAQ answer visibility
    function toggleFAQ(index) {
        const answer = document.getElementById(`faq-${index}`);
        answer.style.display = answer.style.display === 'block' ? 'none' : 'block';
    }

    // Search FAQs
    async function searchFAQs() {
        const query = document.getElementById('searchInput').value.trim();
        if (!query) return;
        
        try {
            const response = await fetch(`/api/faqs.php?action=search&q=${encodeURIComponent(query)}`);
            const results = await response.json();
            
            document.getElementById('searchTitle').textContent = `üîç Search Results for "${query}"`;
            
            if (results.length === 0) {
                document.getElementById('searchResults').innerHTML = `
                    <div class="alert alert-info">
                        No FAQs found matching "${query}". Try different keywords.
                    </div>
                `;
            } else {
                const resultsHTML = results.map((faq, index) => `
                    <div class="faq-item">
                        <div class="card">
                            <div class="card-header faq-question" onclick="toggleSearchFAQ(${index})">
                                <h6 class="mb-0">‚ùì ${faq.question}</h6>
                                <small class="text-muted">${getCategoryIcon(faq.category_name)} ${faq.category_name}</small>
                            </div>
                            <div id="search-faq-${index}" class="faq-answer">
                                <div class="card-body">
                                    ${faq.answer.replace(/\n/g, '<br>')}
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                document.getElementById('searchResults').innerHTML = resultsHTML;
            }
            
            showSection('searchSection');
        } catch (error) {
            alert('Error searching FAQs. Please try again.');
        }
    }

    // Toggle search FAQ answer
    function toggleSearchFAQ(index) {
        const answer = document.getElementById(`search-faq-${index}`);
        answer.style.display = answer.style.display === 'block' ? 'none' : 'block';
    }

    // Show specific section
    function showSection(sectionId) {
        ['categoriesSection', 'faqsSection', 'searchSection'].forEach(id => {
            document.getElementById(id).style.display = id === sectionId ? 'block' : 'none';
        });
    }

    // Show categories (back button)
    function showCategories() {
        showSection('categoriesSection');
        document.getElementById('searchInput').value = '';
    }

    // Allow Enter key for search
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchFAQs();
            }
        });
        
        // Load initial data
        loadStats();
        loadCategories();
    });
    </script>

</body>
</html>